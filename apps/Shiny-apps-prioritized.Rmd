---
title: "Shiny apps prioritized"
author: "Wouter de Nooy"
date: "24 July 2017"
output: 
  html_document:
    number_sections : TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = FALSE)
```

# mediation-multipleregression

Section 9.1, Controlling for Effects of Other Predictors
Sketch was labelled: mediation-regression

```{r mediation-multipleregression, fig.cap="How do regression coefficients change if new predictors are added to the model? The light dots and lines represent the simple regression coefficients and their 95% confidence intervals. Dark dots and lines represent results in a regression model including all selected predictors."}
# Goal: Show that regression coefficients change if new predictors are added to
# the regression model.
# For outcome Newspaper Reading Time, display the standardized simple
# (=bivariate) regression coefficients and their 95% confidence intervals of
# predictors Age, Education, Pol. Interest, and News Site Use as gray fat lines
# and dots. Allow the user to add (and remove) predictors to a multiple
# regression model (if possible, by clicking on the predictor's name; if too
# complicated to program, add list of predictors with checkboxes). On selection,
# display and update the standardized regression coefficients of the predictors
# that are included in the model, which are represented as thin blue lines and
# dots.
# Standardized coefficients that are in line with the example data file
# readers.sav:
# Age (simple): 0.88 [0.83; 0.94]
# Age with Educ: 0.89 [0.83; 0.94]
# Age with PolInt: 0.88 [0.83; 0.93]
# Age with News: 0.72 [0.59; 0.85]
# Age with Educ, PolInt: 0.88 [0.83; 0.93]
# Age with Educ, News: 0.71 [0.58; 0.84]
# Age with PolInt, News: 0.67 [0.53; 0.80]
# Age with Educ, PolInt, News: 0.67 [0.53; 0.80] 
# Education (simple): -0.12 [-0.23; -0.01]
# Education with Age: .01 [-0.05; 0.06]
# Education with PolInt: -0.17 [-0.29; -0.06]
# Education with News: 0.06 [0.00; 0.13]
# Education with Age, PolInt: -0.01 [-0.06; 0.05]
# Education with Age, News: 0.02 [-0.03; 0.08]
# Education with PolInt, News: 0.02 [-0.04; 0.08]
# Education with Age, PolInt, News: 0.01 [-0.05; 0.06]
# Pol. Interest (simple): 0.14 [0.03; 0.25]
# PolInt with Age: 0.04 [-0.01; 0.09]
# PolInt with Educ: 0.19 [0.08; 0.30]
# PolInt with News: 0.15 [0.09; 0.21]
# PolInt with Age, Educ: .0.04 [-0.01; 0.10]
# PolInt with Age, News: 0.04 [0.01; 0.07]
# PolInt with Educ, News: 0.14 [0.08; 0.20]
# PolInt with Age, Educ, News: 0.07 [0.01; 0.12]
# News Site Use (simple): -0.84 [-0.90; -0.78]
# News Site Use with Age: -0.18 [-0.31; -0.05]
# News Site Use with Educ: -0.85 [-0.92; -0.79]
# News Site Use with PolInt: -0.84 [-0.90; -0.78]
# News Site Use with Age, Educ: -0.19 [-0.33; -0.06]
# News Site Use with Age, PolInt: -0.23 [-0.36; -0.09]
# News Site Use with Educ, PolInt: -0.85 [-0.91; -0.79]
# News Site Use with Age, Educ, PolInt: -0.23 [-0.37; -0.09]
```

# resid-normal

Section 8.1.5.2, Identically distributed observations. 
Adapt app pred-linearity.

```{r resid-normal, fig.cap="What are the residuals and how are they distributed?"}
# Goal: Understand the meaning of residuals by linking residuals in a
# scatterplot to the x values in a histogram.
# Generate a sample (N = 20?) with a weak negative effect (-0.6) of exposure on
# attitude and exposure, with a sizable error term to have residuals that are
# clearly visible. Generate a sample with uniformly distributed residuals.
# Display the sample as a scatterplot with the regression line and (red) line
# segments linking the dots vertically to the regression line. Display the
# residuals also as a histogram with normal curve. Hovering over/clicking a line
# segment (residual) in the scatterplot should highlight the corresponding bar
# in the histogram. Add a button to draw a new sample.
```

# common-support

Section 8.3.5, Common support

```{r common-support, fig.cap="Common support for the exposure predictor in each category of smoking status."}
# Goal: Sensitize students to the problem of lacking support for conditional
# effects by inspecting the coverage of the predictor for each moderator group.
# Generate a sample for smokers, for former smokers, and for non-smokers each of
# size 30. Give one or two randomly selected groups exposure values in the
# entire range [0, 10], but the remaining group(s) a restricted exposure range
# of 4 to 6 or 1 to 3 score points.
# Randomly assign a neutral, slightly negative, or moderately negative effect of
# exposure on attitude to the group. Display the three groups in a scatterplot
# (attitude by exposure) with different dot colours and their regression lines
# (coloured and labeled).
# Directly below the scatterplot, add a histogram of exposure, showing coverage.
# Allow the user to select groups 'All' (initial value), 'Smokers', 'Former
# smokers', or 'Non-smokers'. On selection, display the appropriate regression
# line and observations in the scatterplot and show their exposure scores in the
# histogram. Note that the scale of the histogram and the x axisof the
# scatterplot must be fixed to [0, 10].
# Add a Generate New button to generate a new dataset.
```

# continuous-interaction-visualization

Section 8.5.5, Visualization of the interaction effect.
Variant of the app continuous-moderator.

```{r continuous-interaction-visualization, fig.cap="Which moderator values are helpful for visualizing moderation?"}
# Goal: Clarify the interpretation of the (unstandardized) interaction effect by
# showing regression lines at different (interesting) moderator scores (display
# slope value).
# Variant of the app continuous-moderator; ensure that there are few predictor
# values at the minimum and maximum values of the moderator. Allow user to pick
# several values for the moderator from a list containing: minimum, maximum,
# first tercile, second tercile, M - 2SD, M - 1SD, M, M + 1SD, M
# + 2SD. Display the selected lines in different colours.
```

#	mediation-confoundertypes

Section 9.3, Two Types of Confounders.
Relatively simple extension of app mediation-indirectcorrelation. 

```{r mediation-confoundertypes, fig.cap="When is a regression effect too large and when is it too small due to a confounder?"}
# Goal: Intuitive understanding of how the pattern of correlation/effect
# directions (signs) relates to decrease or increase of partial effect sizes.
# Adjust app mediation-indirectcorrelation: Add Pol.Cynicism as a fourth
# confounder (r is -0.18 with political interest and -0.14 with reading time).
# Colour negative correlations red instead of blue if the associated confouder
# is selected. This helps to discover that a positive indirect correlation
# (blue-blue or red-red) decreases the partial effect whereas a negative
# indirect correlation (blue-red) increases it.
```

#	mediation-inference

Section 9.6.6, Significance of indirect effects.
Starting point: app mediation-commoncause.

```{r mediation-inference, fig.cap="Does the sampling dsitribution of an indirect effect resemble the sampling distributions of its direct effects?"}
# Goal: Understand that each sample yields a size of the indirect effect, that
# is added to the sampling distribution. Compare this sampling distribution with
# the sampling distributions of the direct effects, to show that the sampling
# distribution of the indirect effect is skewed.
# Sample and display correlations between Age (predictor), Pol.Interest
# (mediator), and Reading Time (outcome) as in app mediation-commoncause but
# sample the correlations from a normal distribution rnorm(mean = 0.5, sd =
# 0.05) for Age->Pol.Interest, rnorm(mean = 0.2, sd = 0.05) for
# Age->ReadingTime, and rnorm(mean = 0.4, sd = 0.05) for
# Pol.Interest->ReadingTime.
# Display standardized regression coefficients for Age->Pol.Interest in blue,
# for Pol.Interest->ReadingTime in green, and for the indirect effect in black.
# In a second row, add three histograms with counts for values of the
# standardized regression coefficients for the direct effect of
# Age->Pol.Interest (blue bars), Pol.Interest->ReadingTime (green bars), and the
# indirect effect (gray bars).
# Add buttons to draw 1 sample, 1,000 samples (if used, superimpose normal curve
# over each histogram), and to reset.
```

#	regression-predict *

Section 8.1.6, Visualizing predictions 
Add parameter coefficients directly in the equations? 

```{r regression-predict, fig.cap="How do predictions based on exposure depend on values of smoking status and smoker contact?"}
# Goal: sensitize student to the notion that prediction in a multiple regression
# model requires selecting one predictor and fixed values for the other
# predictors. Without moderation, the fixed values only change the vertical
# position of the line (that is, the constant) but not the slope.
# Generate a data set with attitude towards smoking as Y and exposure as X with a negative (b = -0.6) more or less linear relation and a regression line for the currently selected values of the covariates (smoking status, initial value is 0) and contact (initial value is 3)): attitude = 0.25 - 0.6 * exposure + 0.50 * smoker +  0.15 * contact
# Display the scatterplot.
# Add the line of a simple regression of attitude on exposure for the generated data in grey.
# Add the multiple regression line.
# Display the multiple regression equation: (see above). 'smoker' is a selection box with two options: 0 = non-smoker, 1 = smoker. 'contact' is followed by a numerical input that accepts values between 0 and 10.
# A change to the smoker selection or contact value triggers the app to redraw the regression line for attitude by exposure for these values of smoking status and (smoker)contact.
```

#	mean-dependent *

Section 2.5.6 Variant of mean-independent. 

```{r mean-dependent, fig.cap="Dependent samples."}
# Demonstrate the construction of a sampling distribution for mean differences
# for paired/dependent samples. Variant of mean-independent.
# Simulate a small (N = 100)) population with a normal distribution (M = 5, SD =
# 1.3). These are the before colourfulness scores. Create the after colourfulness
# scores by subtracting a random uniform score between 0 and 2.
# Represent both populations as dotplots labeled BEFORE and AFTER in the top row
# of the app. Have the dots shaded from dark yellow (low score) to pale yellow
# (high score).
# Add button "Sample 1", to sample one observation: highlight/circle the
# observation both in the BEFORE and AFTER plots. Show the difference score for
# the selected dots and store it as value in the sample (histogram in the 2nd
# row of the app). Display the sample mean as a vertical line with a value.
# If a sample of five (difference scores) has been created, store the sample
# mean in the sampling distribution (bottom histogram).
# Add button to draw 1,000 samples, with results displayed in the sampling
# distribution (histogram in 3rd ro wof the app). Only store the totals of the
# bars in the histogram, get rid of the original samples to save on memory?
```

#	mean-centering-moderator

Section 8.5.3, Mean-centering
Variant of app continuous-moderator. 

```{r mean-centering-moderator, fig.cap="What happens if you mean-center the moderator variable?"}
# Goal: Understand how mean-centering affects the interpretion of the
# conditional effect of the predictor by seeing how the reference value changes
# with mean-centering (and centering on another value, e.g., M plus/minus 1 SD).
# Use same data set as in app continuous-moderator. 
# Display a scatterplot with a line representing the conditional regression line for exposure at moderator (contact) value = 0. Shade dots in scatterplot in accordance with distance of their moderator score to the moderator reference value. 
# Display the current reference value of the moderator: "Line for contact = 0"
# Add a slider 'Contact - x' (equal length as x axis, range [0, 10], initial value 0), labeled with values 0, M - SD, M, M + SD, and 10 (use nice round numbers for SD and M, not exactly the true values). Adjusting the slider updates the regression line in the scatterplot and the reference value label.
```

#	regression-categorical

Section 8.1.4, A categorical predictor and dummy variables.

```{r regression-categorical, fig.cap="What are the predictive effects of smoking status?"}
# Goal: Understanding effects of dummy variables by manipulating the reference
# group.
# Generate numerical outcome data (attitude, range [-5, 5]) for a categorical
# predictor with 3 categories: (1) non-smoker, (2) former smoker, (3) smoker,
# and a random choice of one of the following scenarios:
#* (1 M = -1.7, SD = 1) < (2) = (3 M = 0.75, SD = 1) {initial situation},
#* (1 M = -1.7, SD = 1) = (2) < (3 M = 0.75, SD = 1), 
#* (2  M = -1.7, SD = 1) < (1) = (3 M = 0.75, SD = 1),
#* (1 M = -1.7, SD = 1) < (2 M = 0.75, SD = 1) < (3 M = 1.8, SD = 1). 
# Display jittered scatterplot containing the three groups with group means
# indicated by a line segment and value, regression lines through the reference
# group mean and each of the other group means. Display b and p value of
# regression weights with the regression lines.
# Add input to select the reference group, initially set to group (1). Update
# regression lines and their p values on selection of a new reference group.
# Add button to generate a new plot (with a new scenario).
```

# normal-approx-proportion

Section 2.5.2, Conditions for the use of theoretical probability distributions 
Simple variant of binomial histogram from bootstrapping with superimposed standard normal distribution from normal-approximation.

```{r normal-approx-proportion, fig.cap="How does the shape of the distribution of sample proportions change with sample size and proportion value?"}
#Generate a binomial sampling distribution with population proportion 0.5 and a
#large sample size and display it as a histogram.
# Project the normal distribution with population proportion p as mean and sqrt
# of p(1 - p)/N as standard deviation. Allow the user to change sample size and
# population proportion and update both the sampling distribution and the normal
# curve.
#perhaps adapt/simplify CLT_prop from Shiny-Ed on GitHub,
#https://github.com/ShinyEd/ShinyEd/tree/master/CLT_prop
```

# anova-posthoc

Section 7.1.6, Which groups have different average scores?
Simple adaptation of anova-means.

```{r anova-posthoc, fig.cap="Which groups have different average outcome scores in the population?"}
# Goal: Sensitize students to the need for and problems with post-hoc tests.
# Generate and display a sample as in the app anova-means with option to change
# group means.
# Display the model F test and the results of three t-tests (without Bonferroni
# correction) for pairwise comparisons (if feasible: as labels to the vertical
# arcs between group means in the plot).
```

# anova-twoway

Section 7.3, Different Score Levels for Two Factors
Adapt/extend anova-between.

```{r anova-twoway, fig.cap="?"}
# Goal: Illustrate that different main effects merely use means of different
# groupings.
# Similar to app anova-between but with a double classification of cases
# (according to endorser and sex) and the option to display means of different
# groupings.
# Generate 6 sets of 2 (random) observations (from a normally distributed
# population with mean runif(3, 7) and sd = 1). Assign the groups to the
# experimental treatment factor (endorser, 3 levels) and sex factor (2 levels).
# Represent observations in a dotplot with treatment as dot colour and sex as
# dot shape, each observation with a separate value on the x axis, ordered by
# factor levels.
# Display the grand mean as a horizontal line. 
# Allow the user to select (display) group means on one of the two factors or
# both. On selection, add group means as horizontal lines (coloured for the 3
# levels factor and different line styles for 2 levels factor) with between
# group variation indicated by double-sided arcs between group mean and grand
# mean for each dot (between). Add subgroup (endorser by sex) means if both
# factors are selected.
```

# regression-dichotomy

Section 8.1.3, Dichotomous predictors.

```{r regression-dichotomy, eval=FALSE, fig.cap="What is the difference in attitude between non-smokers and smokers?"}
# Goal: Refresh interpretation of unstandardized regression weight for a
# dichotomous predictor by manipulating group averages.
# Generate attitude scores  with average values -0.6 for non-smokers and 1.0 for
# smokers (N = 20 per group).
# Draw horizontal and vertical lines from the axes to the group means and add a
# regression line (line through the two group means).
# Display the current regression equation beneath or in the plot. 
# Allow the user to change the average score per group. Update the scatterplot,
# regression line and equation, and the horizontal/vertical lines.
# Generate predictor.
x <- c(rep(0, 20), rep(1, 20))
# Generate random errors per group.
set.seed(1272)
e <- rnorm(20, mean = 0, sd = 1)
e <- sign(e) * sqrt(abs(e*abs(e) - mean(e*abs(e)))) # center in squares
e <- c(e, e)
# Set group means
nonsmoker <- -0.6
smoker <- 1.0
# Generate outcome scaled by unstandardized regression coefficient.
y <- nonsmoker + smoker*x + e
lm(y~x)
```

# regression-sampling

Section 8.1.5, Sampling distributions and assumptions.

```{r regression-sampling, fig.cap="What happens to regression lines from sample to sample?"}
# Goal: Understand that regression constant and coefficient(s) have sampling
# distributions.
# Generate a population with a weak negative effect (-0.6) of exposure on
# attitude and exposure, with a sizable error term (so a lot of variation in
# sample regression lines).
# Generate a sample (N = 10) and display it in a scatterplot with regression
# line, labelled with it's unstandardized regression coefficient value. Also
# plot the sampling distribution for the regression coefficient.
# Add a button to allow drawing a new sample; display the new sample and new
# regression line but retain the existing regression lines.
# Add button (or change sampling button) to draw 1,000 samples: don't display
# samples, just update sampling distribution with normal (or t) distribution as
# superimposed curve.
```

# dichotomous-moderator

Section 8.3.1, A dichotomous moderator and continuous predictor.

```{r dichotomous-moderator, fig.cap="Is the effect of exposure on attitude moderated by smoking status?"}
# Goal: Sensitize the student to the notion that moderation in a regression
# model means different slopes for different groups.
# In a graph with attitude as Y axis and exposure as X axis, generate two regression lines, one for smokers and one for non-smokers. 
# Plot the regression lines in a scatterplot. 
# Show the regression equation for each line (preferably in the plot). 
# Systematically vary the slopes (the same, one more negative than the other,
# opposite signs) and the intercept difference (positive, nearly zero,
# negative).
# Add a Generate New button to replace the regression lines by a new pair of lines.
```

# interaction-var-effect

Section 8.3.2, Interaction variable.

```{r interaction-var-effect, fig.cap="What does an interaction variable do?"}
# Goal: Intuitive understanding of the effect of an interaction variable.
# Generate a dataset with 30 observations for the regression model y = 3 -
# 0.5x_1 + 1.5x_2 + 0.3x_1*x_2 with x_1 in the range [0, 10] and x_2 a dummy (0
# or 1) with a random uniform component to each parameter in the range [-.1,
# .1].
# In a scatterplot of attitude (Y) versus exposure (X), display the regression
# line (fat, grey) for the equation with x_2 = 0, labelled with the regression
# equation without the interaction variable. Display smokers and non-smokers
# with different colours/shapes.
# Add a select list labeled 'Add product of exposure and smoking status' with
# the values '--', '0 - Non-smokers', and '1 - Smokers'. Selection of a value
# adds the corresponding regression line to the plot with the category name and
# regression equation. (The line for non-smokers is parallel to the fat gray
# line.)
# Clicking/hovering over the newly created line shows the slope as a sum of the
# conditional and interaction effect, e.g., "Slope: 0.5 * exposure + 0.3 * 1 *
# exposure".
```

# symmetry-predictor-moderator

Section 8.5.4, Symmetry of predictor and moderator
Variant of mean-centering-moderator.

```{r symmetry-predictor-moderator, fig.cap=""}
# Goal: Understand the advantages of mean-centering the predictor by seeing how
# the reference value changes with mean-centering (and centering on another
# value, e.g., M plus/minus 1 SD).
# Use same data set as in app continuous-moderator: predictor = exposure,
# moderator = contact.
# Display scatterplot (x axis not labelled) with conditional regression effect
# for predictor (blue) at moderator value = 0 and conditional effect of
# moderator (red) for predictor = 0.
# Show two additional x axes marking the reference values of the predictor
# (blue) and moderator (red) (range [0, 10], initial value 0).
# Add sliders 'Exposure - x' and 'Contact - x' (equal length as two x axes,
# range [0, 10], initial value 0), labeled with values M - SD, M, and M + SD.
# Adjusting the sliders update the scale of the appropriate x axis (the marked
# point zero moves) and the regression lines in the scatterplot.
```

#	replacement

Section 2.1.1, Sampling with and without replacement.

```{r replacement, fig.cap="Sampling with and without replacement."}
#Create a sample consisting of 10 candies (dots) that are coloured (5 colours)
#and numbered. Display this sample as a dotplot.
# Add a button to create three (bootstrap) samples with replacement and a button
# to create three (bootstrap) samples without replacement.
# Show the three samples: coloured dots with their ID numbers.
```

#	bootstrap-ci

Section 3.5.3, Confidence intervals with bootstrapping
Variant of app bootstrapping.

```{r bootstrap-ci, eval=FALSE, echo=FALSE, fig.cap="How do we construct confidence intervals with bootstrapping?"}
# Adapt app bootstrapping: Show Initial Sample and Sampling Distribution,
# buttons Bootstrap 1000 samples and Draw new initial sample. Increase vertical
# size of sampling distribution but reduce range from 0 to 0.5.
# Add vertical lines for 95% confidence interval limits calculated from
# percentiles in the bootstrapped sampling distribution and limits calculated
# from the standard error (= standard deviation of the bootstrapped sampling
# distribution) times the critical value 1.96 (using a normal approximation).
# Finally, display the average of the bootstrapped sampling distribution as well
# as the true population proportion (0.2).
```

# reshyp-althyp

Section 5.5, 
Adapt type1vs2 or https://github.com/alice-i-cecile/power-calculator-toy? 

```{r reshyp-althyp, fig.cap="Sample size calculator."}
# Adapt app power-calculator-toy
# (https://github.com/alice-i-cecile/power-calculator-toy).
# Show sampling distribution (blue) for average candy weight according to
# research hypothesis (= null hypothesis): 2.8. Colour (blue) the area for not
# rejecting the null and add 95% as label.
# Add sampling distribution (red) for true average candy weight with slider to
# change true population average (range [2, 6], initial value 3.1. different
# from 2.8. Colour (red) areas above the rejection region and add labels with
# percentages for areas (rounded).
# Adjusting the slider changes the location of true sampling distribution, the
# size of the areas under it representing test power, and associated
# percentages.
```

